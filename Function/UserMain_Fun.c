/***************************************************************************************************
*FileName:SDFunction
*Description:一些SD卡的操作函数
*Author:xsx
*Data:2016年4月30日16:06:36
***************************************************************************************************/


/***************************************************************************************************/
/******************************************头文件***************************************************/
/***************************************************************************************************/
#include	"UserMain_Fun.h"
#include	"HttpClient_Fun.h"
#include 	"Iwdg_Driver.h"
#include	"Led_Driver.h"
#include	"Delay.h"
#include	"BettryADC.h"
#include	"WakeUpKey.h"
#include	"SIM800_Fun.h"

#include 	"stdio.h"
/***************************************************************************************************/
/**************************************局部变量声明*************************************************/
/***************************************************************************************************/

/***************************************************************************************************/
/**************************************局部函数声明*************************************************/
/***************************************************************************************************/

/***************************************************************************************************/
/***************************************************************************************************/
/***************************************正文********************************************************/
/***************************************************************************************************/
/***************************************************************************************************/
/***************************************************************************************************/

void UserMainFunction(void)
{
	unsigned int i=0;
	unsigned short cnt = 0;
	unsigned char errorCnt = 0;
	unsigned char status = 0;
	
	printf("System Task Start...\r\n");
	
	while(1)
	{
		
		if(CheckoutKeyIsPressed())
		{
			errorCnt = 0;
			cnt++;
			SetLedState(ON);
			while(errorCnt < 3)
			{
				status = UpLoadFunction(cnt);
				if(0 == status)
					errorCnt++;
				else
					break;
			}
			
			errorCnt = 0;
			if(status == 1)
			{
				while(errorCnt <= 10)
				{
					LedToggle();
					delay_ms(100);
					errorCnt++;
				}
			}
			else if(status == 2)
			{
				
				while(errorCnt <= 5)
				{
					LedToggle();
					delay_ms(1000);
					errorCnt++;
				}
			}
		}

		IWDG_Feed();
		delay_ms(100);
		SetLedState(OFF);
		
		i++;
	}
}

